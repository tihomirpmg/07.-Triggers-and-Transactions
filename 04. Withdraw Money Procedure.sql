CREATE PROC usp_WithdrawMoney (@AccountId INT, @MoneyAmount MONEY)
AS BEGIN TRANSACTION
UPDATE Accounts
SET Balance -= @MoneyAmount WHERE Id = @AccountId
DECLARE @LeftBalance MONEY = (SELECT Balance FROM Accounts WHERE Id = @AccountId)
IF(@LeftBalance < 0)
BEGIN
ROLLBACK
RAISERROR('',16,2) RETURN
END COMMIT